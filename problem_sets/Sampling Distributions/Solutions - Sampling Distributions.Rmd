
---
title: 'Problem Set 08: Sampling Distribution Solutions'
author: "Will Hopper"
output:
  html_document:
    css: "https://wjhopper.github.io/SSW-858/assets/css/lab.css"
    theme: lumen
    toc: yes
    toc_float:
      collapsed: false
    toc_depth: 2
    df_print: paged
    self_contained: true
editor_options: 
  chunk_output_type: console
---

In this problem set, we practice constructing and interpreting confidence intervals using data on textbook prices. These data were collected duing the Fall 2018 semester at UCLA, to compare prices at the Campus bookstore to prices on Amazon.com explore the effects of sampling variability on the sample proportion, and practice constructing sampling distributions using exact, simulation, and estimation methods. Our population of interest will be the bowl of red and white balls from [ModernDive Chapter 7](https://moderndive-bert.netlify.com/7-sampling.html).

First load the necessary packages:

```{r, message=FALSE, warning=FALSE}
library(dplyr)
library(moderndive)
```

Since the `bowl` data frame comes built-in with the `moderndive` package, we don't need to load any outside data for this problem set. Before diving into problems, we'll start with two demonstrations: how to compute the proportion of red balls in a sample, and how to make your random samples reproducible.

## Demonstration 1: Finding the sample proportion
Since the `bowls` data frame represents the balls in the physical bowl from Sabin-Reed 301 using the words "red" and "white", it takes a bit of data wrangling to find the proportion of red balls in the bowl, or in a sample from that bowl. Note that similar a similar procedure is also given in [ModernDive 7.2.1](https://moderndive-bert.netlify.com/7-sampling.html#using-the-virtual-shovel-once).

### Step 1: "Test" each ball for red-ness
We'll use the `==` equality test to compare each row of the `color` column to the word "red". Matches will be represented as `TRUE`s and mismatches will be represented as `FALSE`s. We'll save all those `TRUE` and `FALSE` values in a new column called `is_red`.

```{r, max.print=4}
bowl
mutate(bowl, is_red = color == "red")
```

### Step 2: Use `mean` to find the proportion of red balls
Next, we find the proportion of red balls among the total number of balls by finding the proportion of `TRUE`s among the total number of logical values. We can actually do this in one quick step, using the `mean` function to average all the logical values!

```{r}
mutate(bowl, is_red = color == "red") %>%
  summarize(p_red = mean(is_red))
```

We learn that 37.5% of the balls in the bowl are red (900 out of 2400).

**Why does using this technique work?** Recall the formula for the mean:

$$\frac{\sum_{i=1}^{n}{x_i}}{N}$$

In this case, our $x_i$ values were a bunch of `TRUE`s and `FALSE`s - so, the numerator represents the sum of 2,400 `TRUE` and `FALSE` values. How can you add `TRUE` and `FALSE` values together? By treating them as 0's and 1's! So, we have a long sequence like $\sum_{i=1}^{n}{x_i} = 0 + 0 + 0 + 1 + 0 + {} ...{} + 1 + 0 + 0$.

Now, recall that a `TRUE` meant red. This means that in our sum, we have a 1 for every red ball, and a 0 for every white ball. Thus, it's like our white balls don't count towards the sum - only red balls do. This realization makes it clear that the numerator of our formula represents counting up the number of red balls! So, we end up with the number of red balls divided by the total number of ball, $N$ - in other words, the proportion of red balls!

### Step 3: Use `var` to find the variance of the red balls
Just like we used the `mean` function to find the sample proportion, we can use the `var` function to find the sample variance of all those 0's (white balls) and 1's (red balls).

```{r}
mutate(bowl, is_red = color == "red") %>%
  summarize(p_red = mean(is_red),
            sigma_sq = var(is_red)
            )
```

We're done! We have the proportion of red balls in the population (a.k.a. the population mean, .375), as well as the population variance (.234) two very important values to keep in mind throughout the rest of this problem set.

## Demonstration 2: Reproducing your random samples
Consider the following 3 random samples of balls from the bowl, paying attention to the values of the `ball_ID` variable obtained each time.
```{r}
rep_sample_n(bowl, size = 3, reps = 1)
rep_sample_n(bowl, size = 3, reps = 1)
rep_sample_n(bowl, size = 3, reps = 1)
```

No ball appeared in multiple samples. In fact, each sample was completely unique (in terms of ball ID's at least, if not colors). But now, consider the next three random samples:
```{r}
set.seed(10)
rep_sample_n(bowl, size = 3, reps = 1)
set.seed(10)
rep_sample_n(bowl, size = 3, reps = 1)
set.seed(10)
rep_sample_n(bowl, size = 3, reps = 1)
```

Now, our three samples are perfectly identical - we got balls 491, 368, and 1484 each time. And, it's easy to see what we did differently to make this happen - we used the `set.seed()` function. But, what does `set.seed(10)` do?

Briefly, it controls how R's *Random Number Generator* (RNG) behaves. R uses a RNG to generate random samples of data, and while the sequence of numbers it generates is completely unpredictable once it starts, we do have control over one aspect of the RNG: *where it starts* generating random numbers. If we can make the RNG always start its sequence in a particular location, we can make it generate the same random numbers again and again. That's what the `set.seed()` function does: it "seeds" the random number generator with a particular starting location of your choosing (that's what the number inside the parenthesis is for).

So, what does this mean for your problem set? It means that **whenever you use the `rep_sample_n` function, you should first seed the random number generator using set.seed()**. The number you put inside the parenthesis is not important. What is important is that you:

1. Seed the RNG before each sample, so you can re-obtain an identical sample if needed (e.g., so you get the same answer every time you knit the document).
2. Using a *unique* seed number for each unique sample, so that your sample for problem two is not the same as for problem three, or problem four. Sampling distributions are quite boring when there is no variability between samples =)

To help remind you, I'll give you a "suggested seed" value for each problem where you need to take a random sample from the bowl. Now, on with the problems!

## Exercise
Based on what you know about the population (the bowl of red and white balls) from Demonstration #1, specify what you know about the sampling distribution of the proportion of red balls, assuming samples of size 19. Be sure to explain your methodology. Remember, the sample proportion is the same as the sample mean in this case! 

### Solution
In Demonstration #1, we found the proportion of red balls in the population to be .375 and the population variance to be .234. The Central Limit Theorem tells us that the sampling distribution of the proportion will be a normal distribution, with the same mean as the population proportion (i.e., the population mean), and a variance equal to the population variance divided by the size of the sample.

So, we know that sampling distribution of the proportion of red balls will be a normal distribution with a mean of .375 and a variance of .234/19 = 0.0123 when there are 19 balls per sample.

## Exercise
Conduct a simulation to estimate the properties of the sampling distribution of the proportion of red balls (again assuming samples of size 19) and compare these properties with the true values found in Exercise 1. To perform this simulation, you should use the `rep_sample_` function to collect 1,000 independent samples (i.e., your simulation should collect 1,000 replicates).

**Suggested Seed: `set.seed(99)`**

### Solution
```{r}
set.seed(99)
sampling_simulation <- rep_sample_n(bowl, size = 19, reps = 1000) %>%
  mutate(is_red = color == "red") %>%
  group_by(replicate) %>%
  summarize(p_hat_red = mean(is_red))

mean(sampling_simulation$p_hat_red)
var(sampling_simulation$p_hat_red)
```

As expected, the mean and variance of the sampling distribution constructed by sampling the population 1000 times and estimating the proportion of red balls each time were very close to the true values!

**Note #1:** If a different seed is used, then the values for the mean and variance will be different

**Note #2:** A common error is dividing the variance of the $\hat{p}$ values by the sample size (19), or computing the variance of each individual sample (and perhaps also dividing by N). But, we don't have to apply the central limit theorem to estimate the properties of the sampling distribution in this case - we're explicitly constructing the sampling distribution by literally sampling again and again. So, we just have to take the mean and variance of the 1,000 $\hat{p}$ values we obtained!

## Exercise
Use a single sample of 19 balls to estimate the properties of the sampling distribution of the proportion of red balls, and compare these properties with the true values found in Exercise 1. To obtain this sample, you should use the `rep_sample_n` function again. Be sure to explain your methodology for estimating the properties of the sampling distribution.

**Suggested Seed: `set.seed(321)`**

### Solution
```{r}
set.seed(321)
one_sample <- rep_sample_n(bowl, size = 19, reps = 1) %>%
  mutate(is_red = color == "red") %>%
  summarize(p_hat_red = mean(is_red),
            s_sq = var(is_red)
            )
one_sample
```

The proportion of red balls in our sample was .421, and the sample variance was .257. Using these as estimates of their respective population parameters, we can use the central limit theorem to estimate the properties of the sampling distribution. So, based on this sample, we estimate the mean of the sampling distribution of the proportion of red balls to have a mean of .421, and a variance of .257/19 = .013. Our estimate of the mean is somewhat high, but our estimate of the variance is quite accurate.

**Note #1:** If a different seed is used, then the values for the mean and variance will be different

## Exercise

Repeat Exercises one through three again, but this time assuming 190 observations per sample. Then, use your work from all the exercises to replace the NA values in the following tables below. What characteristic of the sampling distribution is revealed by comparing row one and row two in each table?

**Suggested Seed: set.seed(510)**

#### Table 1: Mean of the sampling distribution the proportion red balls

| Sample Size ($N$) | Exact Mean | Mean estimated by simulation | Mean estimated using one sample |
| :---------------: | :--------: | :--------------------------: | :-----------------------------: |
| 19                | NA         | NA                           | NA                              |
| 190               | NA         | NA                           | NA                              |

#### Table 2: Variance of the sampling distribution the proportion red balls

| Sample Size ($N$) | Exact Variance | Variance estimated by simulation | Variance estimated using one sample |
| :---------------: | :------------: | :------------------------------: | :---------------------------------: |
| 19                | NA             | NA                               | NA                                  |
| 190               | NA             | NA                               | NA                                  |

### Solution

We can fill out the first row of each table based on work down in exercises 1-3. We also know the mean doesn't change with sample size, only the variance does, so we can fill out row 2, column 2 of Table 1 with the same mean as before. We divide the population variance by 190 instead of 19 to find the true variance of the sampling distribution assuming 190 samples, which gives us row 2, column 2 of Table 2.

For the remaining four values, we need to collect new samples, this time collecting 190 balls per sample:

So to complete row two, column three ("... estimated by simulation") of both tables, we can do:
```{r}
set.seed(510)
## Note the change to the size argument >>>>>>>>>   
sampling_simulation_190 <- rep_sample_n(bowl, size = 190, reps = 1000) %>%
  mutate(is_red = color == "red") %>%
  group_by(replicate) %>%
  summarize(p_hat_red = mean(is_red))

mean(sampling_simulation_190$p_hat_red)
var(sampling_simulation_190$p_hat_red)
```

And to complete row two, column four ("... estimated using one sample") of both tables, we can do:
```{r}
set.seed(510)
## Note the change to the size argument >>>
one_sample_190 <- rep_sample_n(bowl, size = 190, reps = 1) %>%
  mutate(is_red = color == "red") %>%
  summarize(p_hat_red = mean(is_red),
            s_sq = var(is_red)
            )
one_sample_190
```

#### Table 1: Mean of the sampling distribution the proportion red balls

| Sample Size ($N$) | Exact Mean | Mean estimated by simulation | Mean estimated using one sample |
| :---------------: | :--------: | :--------------------------: | :-----------------------------: |
| 19                | 0.375      | 0.370                        | 0.421                           |
| 190              | 0.375       | 0.375                        | 0.332                           |

#### Table 2: Variance of the sampling distribution the proportion red balls

| Sample Size ($N$) | Exact Variance | Variance estimated by simulation | Variance estimated using one sample |
| :---------------: | :------------: | :------------------------------: | :---------------------------------: |
| 19                | 0.0123         | 0.0118                           | 0.0135                              |
| 190               | 0.00123        | 0.00112                          | 0.00117                             |


The biggest take away is that the variance of the sampling distribution gets smaller as samples get larger - a sample ten times bigger yields a variance ten times smaller! Our estimates of the population proportion are also a bit more accurate the more balls we observe in each sample. This makes sense given what we know the relationship between sample size and the variance of the sampling distribution - with bigger samples, there is less variability in sample means, meaning values closer to the true population mean are more likely when samples are large than when samples are small!


## Exercise
Why are the *exact* properties of the sampling distribution never known, or estimated by repeatedly sampling (like our simulations do), in real life situations?

### Solution
Because we almost never have the time and resources to conduct a full census, or to repeatedly sample from the population over and over again.

